This is a [Next.js](https://nextjs.org/) project of a twitter clone course based on [`build a twitter clone`](https://egghead.io/courses/build-a-twitter-clone-with-the-next-js-app-router-and-supabase-19bebadb)

The database is made with [`supabase`](https://supabase.com)
To use supabase with nextJS we use the [`@supabase/auth-helpers-nextjs`](https://supabase.com/docs/guides/auth/auth-helpers/nextjs#install-nextjs-auth-helpers-library) library


# Start the project

First, install all dependencies:

```bash
pnpm install
```

then you can run the development server:

```bash
pnpm run dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.


# UI

The UI is mainly made with [tailwindcss](https://tailwindcss.com/) that is a CSS framework allowing to customize the CSS of the components realy quickly.
In addition, we use [nextUI](https://nextui.org/), that builds on top of tailwind, we use it to have some specific components like the tweet cards.
We use [Flowbite](https://flowbite.com/) to find some components.
For the icons we are using [Tabler Icons](https://tabler-icons.io/)


# session storage

We store the user session in cookies:
- cookies are a bit more secure than localstorage
- with localstorage we can not read the content from the server
- supabase needs to read the session from the server so we use cookies


# Async Server Component Typescript Error
  
  When we use the `AsyncServerComponent` we have a typescript error. This is a known issue with Typescript and is being worked on.
  To fix this we need to add the following code before using an Async Server Compenent:
  ```ts
  {/* @ts-expect-error Async Server Component */}
  ```

  You can find the information [here](https://nextjs.org/docs/app/building-your-application/configuring/typescript#async-server-component-typescript-error)


# Supabase

We have to create a public table of Users because there are no permissions that allow access to read the user.
The table is refered of the auth user, using the uuid.
For this, we have a function that is triggered when a user is created, and this function create a new row in the public table of users.

```sql
begin
  insert into public.users (id, name, user_name, avatar_url)
  values(
    new.id,
    new.raw_user_meta_data->>'name',
    new.raw_user_meta_data->>'user_name',
    new.raw_user_meta_data->>'avatar_url'
  );
  return new;
end
```

### Generate types

To generate the types of the database we use the following command:
Important -> is necessary to be logged in to supabase by `npx supabase login` and providing the access token by following the instructions on the terminal

```bash
pnpm run gen:types
```


The reference-id that we provide on the script can be found on the supabase dashboard in the general settings of the project


### Server Actions

Server Actions are currently in Alpha in supabase, so this can change in the future.

Inside the method we need to specify that is only server usage by adding `'use server'` and we have to enable them on the `next.config.js` file:
  
```js
const nextConfig = {
  "experimental":{
    "serverActions": true
  }
}
```


#### user

The public table of users have:
- `id` Foreign key of the auth table of users uuid,
- `created_at` timestamp of the moment of creation
- `name` name of the user as String
- `username` username of the user as String
- `avatar_url` url of the avatar image as String

#### posts

The public table of users have:
- `id` uuid autogenerated
- `created_at` timestamp of the moment of creation
- `content` String of the content of the post
- `user_id` Foreign key of the auth user uuid


#### data deletion

When a user is deleted, all content created by this user is deleted automaticaly by cascade. The same is happening with users public table